# YAML test definition

## Full Definition
```
- name: 
  before:
  - type: 
    values:
      - 
  command:
    commandText: 
    parameters:
    - name: 
      type: 
      value: 
  results:
    resultSets:
    - name: 
      rowNumber: 
      columns:
      - name: 
        type: 
    outputParameters:
    - name: 
      type: 
      value: 
    returnCode:
  asserts:
    - sqlQuery:
      scalarType:
      scalarValue:
  after:
  - type: 
    values:
    - 
```
## Sections
### name
_Required_<br>
The full name of the test.

### before
_Optional_<br>
Array of [Scripts](#script) object that runs before the command is executed.<br>
Before scripts run in a single transaction.

### command
__Mandatory__<br>
A single element representing the command (Stored Procedure) to run.
|Attribute|Description|M/O|Notes|
|---|---|:---:|---|
|__commandText__|The Stored Procedure to run|__M__||
|__parameters__|A list of [Parameters](#parameter)|_O_||

### results
_Optional_<br>
The definition of the results to verify.
|Attribute|Description|M/O|Notes|
|---|---|:---:|---|
|resultSets|A list of [ResultSets](#resultset)|_O_||
|outputParameters|A list of [Parameters](#parameter)|_O_||
|returnCode| The return code value |_O_||

### asserts
_Optional_<br>
The definition of the asserts to run.<br>
A list of [Assert](#assert) objects.

### after
_Optional_<br>
Array of [Scripts](#script) object that runs after the command is executed.<br>
Generally used to delete the data provided/generated by the test.

## Types

### Assert
Definition of an assert.
```
sqlQuery:
scalarType:
scalarValue:
```
|Attribute|Description|M/O|Notes|
|---|---|:---:|---|
|__sqlQuery__|Query to run|__M__|Must return a single value as a result set (one row, one column)|
|__scalarType__|Expected type of the scalar returned from the assert|__M__|See [Types](#type)|
|__scalarValue__|Expected value the scalar returned from the assert|__M__||

### Parameter
Definition of a parameter.
```
name:
type:
value:
```
|Attribute|Description|M/O|Notes|
|---|---|:---:|---|
|__name__|Name of the parameter|__M__|Without __@__|
|__type__|Type of the parameter|__M__|See [Types](#type)|
|__value__|Value of the parameter|_O_|Mandatory depends on what is defined in the database|

### ResultSet
Definition of a result set.
```
- name: 
  rowNumber: 
  columns:
  - name: 
    type: 
```
|Attribute|Description|M/O|Notes|
|---|---|:---:|---|
|__name__|Name of the result set|__M__||
|__columns__|Definition of the columns of the result set|__M__||
|__rowNumber__|Expected number of rows|_O_||

Each column is defined as:
|Attribute|Description|M/O|Notes|
|---|---|:---:|---|
|__name__|Name of the column of the result set|__M__||
|__type__|Type of the column|See [Types](#type)|__M__||

### Script
Definition of a script to run.
```
type: Inline | File
values:
  -
```
|Attribute|Description|M/O|Notes|
|---|---|:---:|---|
|__type__|Type of the script|_Inline_ or _File_|__M__|
|__value__|If __type__ is _Inline_: a list of SQL commands<br>If __type__ is _File_: a list of path to text files |__M__|Files path shoud be relative to the __qest__ excutable|

Each __Script__ entity is ran atomically: the strings / files are concatenated in a single SQL batch joined by ";".

### Type
The types used are the text representation of the _SqlDBType_ C# enum.
The supported types are:
 - Bit
 - TinyInt
 - SmallInt
 - BigInt
 - Int
 - Float
 - Real
 - Decimal
 - Money
 - NVarChar
 - DateTime
 - DateTime2
 - DateTimeOffset
 - Date
 - Time